<!DOCTYPE html>
{% set lang = lang if lang else 'en' %}
<html lang="{{ 'pt-BR' if lang == 'pt-BR' else 'en' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ "Interpretador de Sonhos de Jung" if lang == "pt-BR" else "Jungian Dream Interpreter" }}</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#0f2a1e;
      --card:rgba(255,255,255,0.10);
      --cardBorder:rgba(255,255,255,0.18);
      --text:rgba(255,255,255,0.92);
      --muted:rgba(255,255,255,0.72);
      --accent:#6df59a;
      --accent2:#b66bff;
    }

    body{
      font-family: "Space Grotesk", system-ui, sans-serif;
      color: var(--text);
      min-height: 100vh;
      margin: 0;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(182,107,255,0.28), transparent 60%),
        radial-gradient(900px 600px at 85% 30%, rgba(109,245,154,0.22), transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
    }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity: .25;
    }

    .app-shell{ max-width: 980px; }

    .glass{
      background: var(--card);
      border: 1px solid var(--cardBorder);
      border-radius: 22px;
      backdrop-filter: blur(14px);
      box-shadow: 0 12px 45px rgba(0,0,0,0.35);
    }

    .brand-dot{
      display:inline-block;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      margin-right: 10px;
    }

    .subtitle{
      color: var(--muted);
      max-width: 52ch;
      margin: 0 auto;
    }

    .lang-pill .btn{
      border-radius: 999px;
      padding: .35rem 1rem;
      font-weight: 700;
      border: 1px solid rgba(255,255,255,0.25);
      color: rgba(255,255,255,0.86);
      background: rgba(0,0,0,0.12);
    }

    textarea.form-control{
      background: rgba(10,14,20,0.55) !important;
      color: var(--text) !important;
      border: 1px solid rgba(255,255,255,0.18) !important;
      border-radius: 16px;
      padding: 14px;
    }

    .btn-primary{
      border: 0;
      border-radius: 14px;
      padding: 12px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #081012;
    }

    .black-output{
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.18);
      color: rgba(255,255,255,0.90);
      padding: 1.1rem;
      border-radius: 18px;
      font-family: monospace;
      white-space: pre-wrap;
      text-align: left;
    }

    .img-frame{
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.18);
    }
  </style>
</head>

<body>
  <div class="container py-5 app-shell">

    <div class="glass p-4 p-md-5 text-center">
      <h1 class="display-6 mb-2">
        <span class="brand-dot"></span>
        {{ "Interpretador de Sonhos de Jung" if lang == "pt-BR" else "Jungian Dream Interpreter" }}
      </h1>

      <p class="subtitle mb-4">
        {{ "Receba uma uma imagem de seu sonho"
           if lang == "pt-BR"
           else "Paste your dream and get an image interpretation" }}
      </p>

      <!-- Language Toggle -->
      <div class="d-flex justify-content-center mb-3 lang-pill">
        <input type="radio" class="btn-check" name="lang_toggle" id="lang_en"
               {% if lang != "pt-BR" %}checked{% endif %}>
        <label class="btn" for="lang_en" onclick="setLang('en')">EN</label>

        <input type="radio" class="btn-check" name="lang_toggle" id="lang_pt"
               {% if lang == "pt-BR" %}checked{% endif %}>
        <label class="btn" for="lang_pt" onclick="setLang('pt-BR')">PT-BR</label>
      </div>

      <form method="POST" class="mx-auto col-md-10 col-lg-8">
        <input type="hidden" name="lang" id="lang" value="{{ lang or 'en' }}">

        <div class="mb-3">
          <textarea
            name="prompt"
            rows="5"
            class="form-control"
            placeholder="{{ 'Descreva seu sonho aqui...' if lang == 'pt-BR' else 'Describe your dream here...' }}"
          >{{ prompt or "" }}</textarea>
        </div>

        <div class="d-grid">
          <input type="submit"
                 value="{{ 'Enviar meu sonho' if lang == 'pt-BR' else 'Send my dream' }}"
                 class="btn btn-primary">
        </div>
      </form>
    </div>

    {% if result or image_data_url %}
    <div class="row g-4 mt-4">
      {% if result %}
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <h3>{{ "Resposta" if lang == "pt-BR" else "Response" }}</h3>
          <div class="black-output">{{ result }}</div>
        </div>
      </div>
      {% endif %}

      {% if image_data_url %}
      <div class="col-lg-6">
        <div class="glass p-4 h-100">
          <h3>{{ "Imagem" if lang == "pt-BR" else "Image" }}</h3>
          <div class="img-frame">
            <img src="{{ image_data_url }}" alt="Dream image" class="img-fluid">
          </div>
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}

  </div>

  <script>
    function setLang(value) {
      const hidden = document.getElementById("lang");
      if (hidden) hidden.value = value;

      const ta = document.querySelector('textarea[name="prompt"]');
      const btn = document.querySelector('input[type="submit"]');
      const title = document.querySelector('h1');
      const subtitle = document.querySelector('.subtitle');

      if (value === "pt-BR") {
        document.title = "Interpretador de Sonhos de Jung";
        if (title) title.childNodes[2].textContent = " Interpretador de Sonhos de Jung";
        if (subtitle) subtitle.textContent = "Receba uma uma imagem de seu sonho";
        if (ta) ta.placeholder = "Descreva seu sonho aqui...";
        if (btn) btn.value = "Enviar meu sonho";
      } else {
        document.title = "Jungian Dream Interpreter";
        if (title) title.childNodes[2].textContent = " Jungian Dream Interpreter";
        if (subtitle) subtitle.textContent = "Paste your dream and get an image interpretation";
        if (ta) ta.placeholder = "Describe your dream here...";
        if (btn) btn.value = "Send my dream";
      }
    }
  </script>
</body>
</html>
